Remote Objectives
=================

Some quests need special logic or storage that the daemon cannot provide. In these cases the daemon can send a request to a remote service to determine the action to take.

The objective should be configured with the type `REMOTE` and the `remote_endpoint` field must be filled in. Any query parameters specified in the remote endpoint will be preserved and passed to the remote service.

When a player activates the remote objective the daemon will send a request to the external service. The request will contain the activating account information, including name and inventory, and the full text used to activate the objective. The service can respond in several ways, detailed below.

## Request
The request from the daemon will be a POST w/ a Content-Type of application/json.

The body will contain a JSON dictionary consisting of the following keys.

| Name | Data Type | Description |
|:----:|:---------:|-------------|
| code | string | Text sent to the daemon by the player |
| account_id | int64 | unique account id for the player. Use this id if storing data, it will not change |
| display_name | string | Current display name for the player. Do not key off the data, it is for messaging and debugging only. Players are not guarenteed unique or stable names |
| inventory | dictionary | Current state of the inventory |

## Inventory
| Name | Data Type | Description |
|:----:|:---------:|-------------|
| bags | dictionary | Map of bag type to bag data |

## Bag
| Name | Data Type | Description |
|:----:|:---------:|-------------|
| items | array | List of items in the bag |

## Item
| Name | Data Type | Description |
|:----:|:---------:|-------------|
| item_type | string | Internal name of item |
| flags | int | Item flags |
| count | int | Number of items of this type the player currently owns |
| max_count | int | Maximum number of this item a player can own |
| metadata | dictionary | Name-value pairs that hold extra item data |

### Example
``` 
{
	"code": "Hello World",
    "display_name": "Bob",
    "account_id": 5,
	"inventory": {
		"bags": {
			"ITEM": {
				"items": [{
					"item_type": "Item1",
					"flags": 0,
					"count": 1,
					"max_count": 100,
					"metadata": {
                      "foo": "bar"
                    }
				}, {
					"item_type": "Item2",
					"flags": 0,
					"count": 1,
					"max_count": 100,
					"metadata": null
				}]
			}
		}
	}
}
```

# Response
All responses should have a status code of 200 and contain a valid body. Any non-200 or invalid response returned will result in an "internal error" message sent to the player.

The response body is a JSON dictionay containing the following fields:

| Name | Data Type | Required | Description |
|:----:|:---------:|:--------:|-------------|
| success | bool | Y | If set to false, objective will be failed instead of incremented |
| inc | int | N | If sucess is true, the number of times to increment the objective |
| message | string | N | Message to send to player in for form of an event (see protocol.md). Event will be of type 'OBJ' with action 'MESSAGE' |
| metadata | dictionary | N | Dictionary of key values pairs to be placed on any new items generated by rewards attached to this objective. All metadata values must be strings |

### Example
```
{
    "success": true,
    "message": "Gratz!",
    "inc": 1,
    "metadata": {
       "badge_code": "12345"
    }
}
```
